{% extends "base" %}

{% block content %}
${(function() {
    const page = Math.max(1, Number(data?.page || 1));
    const { items: posts, total: totalPosts } = db.Post.paginate(page);
    
    const hasMore = totalPosts > (page * 10);
    const totalPages = Math.ceil(totalPosts / 10);

    const processedPosts = posts.map(post => ({
        ...post,
        metadata: typeof post.metadata === 'string' ? 
            JSON.parse(post.metadata || '{}') : 
            post.metadata || {}
    }));

    return `
            <ul class="blog-list">
                ${processedPosts.length > 0 ? processedPosts.map(post => `
                    <li>
                        <h2><a href="/${post.slug}">${post.title || 'Untitled'}</a></h2>
                        ${post.metadata?.date ? `<time datetime="${post.metadata.date}">${post.metadata.date}</time>` : ''}
                        ${post.metadata.excerpt ? `<p>${post.metadata.excerpt}</p>` : ''}
                    </li>
                `).join('') : '<li>No posts available</li>'}
            </ul>
            
            <nav class="pagination">
                ${page > 1 ? 
                    `<a href="?page=${page - 1}" rel="prev">← Previous</a>` : 
                    '<span class="pagination-placeholder"></span>'
                }
                ${hasMore ? 
                    `<a href="?page=${page + 1}">Next →</a>` : 
                    '<span></span>'
                }
            </nav>
        `
    });
})()}
